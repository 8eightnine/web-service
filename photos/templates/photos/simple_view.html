{% extends 'base.html' %}
{% load static %}

{% block title %}–ü—Ä–æ—Å—Ç–æ–π View{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h1 class="mb-0 text-center">
                        <i class="fas fa-camera"></i> –ü—Ä–æ—Å—Ç–æ–π View –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏
                    </h1>
                </div>
                <div class="card-body">
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                <i class="fas fa-info-circle"></i> {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                    
                    <div class="text-center mb-4">
                        <p class="lead">{{ message }}</p>
                        <p class="text-muted">–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</p>
                    </div>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="stat-card">
                                <div class="text-center">
                                    <div class="empty-state-icon text-primary mb-3">üìä</div>
                                    <h3 class="text-primary">{{ photos_count }}</h3>
                                    <p class="mb-0">–í—Å–µ–≥–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ –≥–∞–ª–µ—Ä–µ–µ</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="stat-card">
                                <div class="text-center">
                                    {% if latest_photo %}
                                        <div class="empty-state-icon text-success mb-3">üì∑</div>
                                        <h5 class="text-success">{{ latest_photo.title|truncatechars:25 }}</h5>
                                        <p class="mb-1">–ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è</p>
                                        <small class="text-muted">{{ latest_photo.uploaded_at|date:"d.m.Y H:i" }}</small>
                                    {% else %}
                                        <div class="empty-state-icon text-muted mb-3">üì∑</div>
                                        <h5 class="text-muted">–ù–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</h5>
                                        <p class="mb-0">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–≤—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ü—Ä–µ–≤—å—é –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ -->
                    {% if latest_photo %}
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="category-description">
                                <h4 class="mb-3">
                                    <i class="fas fa-star text-warning"></i> 
                                    –ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è
                                </h4>
                                <div class="photo-card" style="max-width: 100%; height: auto;">
                                    <div class="row g-0">
                                        <div class="col-md-4">
                                            <div class="photo-card-image" style="height: 250px;">
                                                <img src="{{ latest_photo.image.url }}" 
                                                     alt="{{ latest_photo.title }}"
                                                     style="width: 100%; height: 100%; object-fit: cover; border-radius: var(--border-radius) 0 0 var(--border-radius);">
                                            </div>
                                        </div>
                                        <div class="col-md-8">
                                            <div class="photo-card-content" style="height: 250px; padding: var(--spacing-lg);">
                                                <h5 class="photo-title mb-3">{{ latest_photo.title }}</h5>
                                                <p class="photo-card-description mb-3">{{ latest_photo.description|truncatechars:150 }}</p>
                                                
                                                <div class="photo-meta mb-3">
                                                    <div class="tags-container mb-2">
                                                        {% for tag in latest_photo.tags.all|slice:":4" %}
                                                            <span class="tag">{{ tag.name }}</span>
                                                        {% empty %}
                                                            <span class="no-tags">–ë–µ–∑ —Ç–µ–≥–æ–≤</span>
                                                        {% endfor %}
                                                    </div>
                                                    
                                                    <div class="author-info">
                                                        <span class="category-badge">{{ latest_photo.get_category_type_display }}</span>
                                                        <span class="upload-time">{{ latest_photo.uploaded_at|date:"d.m.Y" }}</span>
                                                    </div>
                                                </div>
                                                
                                                <div class="mt-auto">
                                                    <small class="text-muted d-block mb-2">
                                                        <i class="fas fa-user"></i> {{ latest_photo.get_uploader_display }}
                                                    </small>
                                                    <a href="{% url 'photo_detail_slug' latest_photo.slug %}" 
                                                       class="btn btn-primary">
                                                        <i class="fas fa-eye"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- –ü–∞–Ω–µ–ª—å –¥–µ–π—Å—Ç–≤–∏–π -->
                    <div class="row mt-5">
                        <div class="col-md-12">
                            <div class="user-stats">
                                <h4 class="mb-4">
                                    <i class="fas fa-tools"></i> 
                                    –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                                </h4>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <div class="d-grid gap-2">
                                            <form method="post" class="d-inline">
                                                {% csrf_token %}
                                                <input type="hidden" name="action" value="refresh_stats">
                                                <button type="submit" class="btn btn-info w-100">
                                                    <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6 mb-3">
                                        <div class="d-grid gap-2">
                                            <form method="post" class="d-inline">
                                                {% csrf_token %}
                                                <input type="hidden" name="action" value="clear_cache">
                                                <button type="submit" class="btn btn-warning w-100">
                                                    <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ -->
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="category-description">
                                <h4 class="mb-3">
                                    <i class="fas fa-compass"></i> 
                                    –ù–∞–≤–∏–≥–∞—Ü–∏—è
                                </h4>
                                
                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <a href="{% url 'photo_list' %}" class="btn btn-success w-100">
                                            <i class="fas fa-images"></i><br>
                                            <small>–í—Å–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</small>
                                        </a>
                                    </div>
                                    
                                    <div class="col-md-3 mb-3">
                                        <a href="{% url 'upload_photo' %}" class="btn btn-primary w-100">
                                            <i class="fas fa-upload"></i><br>
                                            <small>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</small>
                                        </a>
                                    </div>
                                    
                                    <div class="col-md-3 mb-3">
                                        <a href="{% url 'tag_list' %}" class="btn btn-secondary w-100">
                                            <i class="fas fa-tags"></i><br>
                                            <small>–í—Å–µ —Ç–µ–≥–∏</small>
                                        </a>
                                    </div>
                                    
                                    <div class="col-md-3 mb-3">
                                        <a href="{% url 'stats' %}" class="btn btn-info w-100">
                                            <i class="fas fa-chart-bar"></i><br>
                                            <small>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</small>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
                    {% if photos_count == 0 %}
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="empty-state">
                                <div class="empty-state-icon">üì∑</div>
                                <h3>–ì–∞–ª–µ—Ä–µ—è –ø—É—Å—Ç–∞</h3>
                                <p>–ü–æ–∫–∞ —á—Ç–æ –≤ –≥–∞–ª–µ—Ä–µ–µ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏. –ù–∞—á–Ω–∏—Ç–µ —Å –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–≤–æ–π!</p>
                                <a href="{% url 'upload_photo' %}" class="btn btn-primary btn-lg">
                                    <i class="fas fa-plus"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é
                                </a>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="alert alert-info">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h5 class="alert-heading mb-2">
                                            <i class="fas fa-lightbulb"></i> –°–æ–≤–µ—Ç
                                        </h5>
                                        <p class="mb-0">
                                            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–≥–∏ –¥–ª—è –ª—É—á—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤–∞—à–∏—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π. 
                                            –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –Ω–∞—Ö–æ–¥–∏—Ç—å –Ω—É–∂–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è!
                                        </p>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <a href="{% url 'tag_list' %}" class="btn btn-outline-info">
                                            –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–≥–∏
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <div class="card-footer text-center text-muted">
                    <small>
                        <i class="fas fa-code"></i> 
                        –ü—Ä–æ—Å—Ç–æ–π View –∫–ª–∞—Å—Å - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ Django
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ */
.stat-card {
    background: linear-gradient(135deg, var(--white) 0%, var(--light-gray) 100%);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: var(--spacing-xl);
    box-shadow: 0 4px 8px var(--shadow-light);
    transition: transform var(--transition-normal), box-shadow var(--transition-normal);
    height: 100%;
}

.stat-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 16px var(--shadow-medium);
}

.btn i {
    margin-right: var(--spacing-xs);
}

.btn small {
    display: block;
    margin-top: var(--spacing-xs);
    font-size: var(--font-size-xs);
}

.card-header.bg-primary {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%) !important;
}

.alert-info {
    border-left: 4px solid var(--info-color);
}

.photo-card {
    background: var(--white);
    border-radius: var(--border-radius);
    box-shadow: 0 4px 12px var(--shadow-light);
    overflow: hidden;
    transition: transform var(--transition-normal), box-shadow var(--transition-normal);
}

.photo-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px var(--shadow-medium);
}

.category-description {
    border-left: 4px solid var(--primary-color);
}

.user-stats {
    border-left: 4px solid var(--success-color);
}
</style>
{% endblock %}